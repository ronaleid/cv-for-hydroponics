# captures frame, saves with timestamped name

# nano /home/ronaleipi/snap_picam.py
# Ctrl O + Enter
# Ctrl X

# take pic: python3 ~/snap_picam.py

#!/usr/bin/env python3
import time, os
from datetime import datetime
from pathlib import Path
import cv2
from picamera2 import Picamera2

SAVE_DIR = Path.home() / "lettuce_imgs"   # /home/ronaleipi/lettuce_imgs
LABEL = "layer1"
WIDTH, HEIGHT = 1920, 1080

SAVE_DIR.mkdir(parents=True, exist_ok=True)

def main():
    picam2 = Picamera2()
    config = picam2.create_still_configuration(main={"size": (WIDTH, HEIGHT)}, buffer_count=2)
    picam2.configure(config)

    picam2.start()
    time.sleep(1.0)
    picam2.set_controls({"AeEnable": False, "AwbEnable": False})
    time.sleep(0.1)

    frame = picam2.capture_array()              # RGB
    bgr = cv2.cvtColor(frame, cv2.COLOR_RGB2BGR)

    ts = datetime.now().strftime("%Y%m%d_%H%M%S")
    out_path = SAVE_DIR / f"{LABEL}_{ts}.jpg"
    cv2.imwrite(str(out_path), bgr, [int(cv2.IMWRITE_JPEG_QUALITY), 90])
    print("Saved", out_path)

if __name__ == "__main__":
    main()
